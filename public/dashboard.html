<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AshAzBoost - Dashboard</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <header>
      <h1>Welcome to AshAzBoost!</h1>
    </header>

    <!-- Wallet Balance & Add Funds Section -->
    <div class="card">
      <h3>üí∞ Wallet Balance</h3>
      <p id="walletBalance">UGX 0</p>
      <h3>‚ûï Add Funds</h3>
      <input type="number" id="depositAmount" placeholder="Enter amount (min 2000 UGX)" min="2000" />
      <button class="mtn" onclick="deposit('MTN')">Deposit with MTN Mobile Money</button>
      <button class="airtel" onclick="deposit('AIRTEL')">Deposit with Airtel Money</button>
      <div class="note">
        Minimum deposit is <b>2000 UGX</b>. Wallet is used automatically when you place orders.
      </div>
    </div>

    <!-- Place Order form -->
    <div class="card">
      <h3>üì¶ Place Order</h3>
      <input type="text" id="orderUrl" placeholder="Enter your URL">
      <input type="number" id="orderQuantity" placeholder="Quantity">
      <select id="orderService">
        <option value="instagram">Instagram</option>
        <option value="twitter">Twitter</option>
        <option value="facebook">Facebook</option>
        <option value="youtube">YouTube</option>
        <option value="telegram">Telegram</option>
        <option value="tiktok">TikTok</option>
        <option value="linkedin">LinkedIn</option>
      </select>
      <button onclick="placeOrder()">Place Order</button>
    </div>

    <!-- Your Orders -->
    <div class="card">
      <h3>üìù Your Orders</h3>
      <ul id="ordersList"></ul>
    </div>

    <footer>
      <p>¬© 2026 AshAzBoost</p>
    </footer>
  </div>

  <!-- JAVASCRIPT -->
  <script>
    const user = "defaultUser"; // For demo, replace with your login system
    let walletBalance = 0;

    // Update wallet balance in the UI
    async function loadWallet() {
      try {
        const res = await fetch(`/api/wallet?user=${user}`);
        const data = await res.json();
        walletBalance = data.wallet;
        updateBalanceUI();
        loadOrders();
      } catch (err) {
        console.log(err);
      }
    }

    function updateBalanceUI() {
      document.getElementById("walletBalance").innerText = "UGX " + walletBalance.toLocaleString();
    }

    // Deposit funds (MTN/Airtel)
    async function deposit(channel) {
      const amount = parseInt(document.getElementById("depositAmount").value);
      if (!amount || amount < 2000) { alert("Minimum deposit is 2000 UGX"); return; }
      const phone = prompt(`Enter your ${channel} phone number (07XXXXXXXX):`);
      if (!phone) return;

      try {
        const res = await fetch("/api/deposit", {
          method: "POST",
          headers: {"Content-Type":"application/json"},
          body: JSON.stringify({user, amount, channel, phone})
        });
        const data = await res.json();
        walletBalance = data.wallet;
        updateBalanceUI();
        window.location.href = data.redirect_url;
      } catch (err) {
        alert("Deposit failed");
      }
    }

    // Place an order
    async function placeOrder() {
      const service = document.getElementById("orderService").value;
      const quantity = document.getElementById("orderQuantity").value;
      const url = document.getElementById("orderUrl").value;
      if (!service || !quantity || !url) return alert("Please fill all fields");

      try {
        const res = await fetch("/api/order", {
          method: "POST",
          headers: {"Content-Type":"application/json"},
          body: JSON.stringify({ user, service, quantity, url })
        });
        const data = await res.json();
        if (data.error) return alert(data.error);
        walletBalance = data.wallet;
        updateBalanceUI();
        alert("Order placed!");
        loadOrders();
      } catch(err) {
        alert("Order failed");
      }
    }

    // Load orders from the user's account
    async function loadOrders() {
      try {
        const res = await fetch(`/api/orders?user=${user}`);
        const data = await res.json();
        const ordersDiv = document.getElementById("ordersList");
        ordersDiv.innerHTML = data.orders.map(o => 
          `<li>${o.service} - ${o.quantity} - ${o.priceUGX} UGX - ${o.status}</li>`
        ).join("");
      } catch(err) { console.log(err); }
    }

    // Initialize the dashboard
    loadWallet();
  </script>
</body>
</html>
